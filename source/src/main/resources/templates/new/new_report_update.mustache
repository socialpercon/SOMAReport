<!DOCTYPE html>
<html lang="ko" style="margin:0px;height:100%">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta http-equiv="Expires" content="-1">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Cache-Control" content="No-Cache">
    <title>somareport</title>
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <link rel="stylesheet" href="http://static.plusquare.com/somareport/theme_new.css">
    <link rel="stylesheet" href="https://cdn.rawgit.com/taitems/iOS-Overlay/gh-pages/css/iosOverlay.css">
    <link rel="stylesheet" type="text/css" href="http://cdn.jsdelivr.net/datetimepicker/latest/DateTimePicker.min.css" />
  </head>
  <body style="margin:0px;height:100%">
    <div style="height:80px;width:100%;background:#fff;position:absolute;z-index:1;">
      <div style="height:80px;width:15%;float:left;background:#6289D9">
        <table style="height:80px;margin-left:15px">
          <center>
          <tr>
            <td style="align:center">
              <img src="/drive/user/image?id={{user_id}}-profileImage" style="border-radius:50%;width:48px;height:48px;display:inline-block;">
            </td>
            <td style="align:center;padding-left:5px">
            <p style="margin:0;font-size:18px;color:rgba(255, 255, 255, 1);">{{name}}</p>
            <p style="margin:0;font-size:14px;color:rgba(255, 255, 255, 0.7);">{{role}}</p>
            </td>
          </tr>
          </center>
        </table>
      </div>
      <div style="height:80px;width:85%;float:right;background:#fff">
        <a href="/project/list" style="text-decoration:none;color:#000;display:inline-block">
        <table style="height:80px">
        <tr>
          <td>
            <i style="padding-left:24px;padding-right:24px" class="material-icons">arrow_back</i>
          </td>
          <td>
            {{#project}}
            <span style="font-size:28px;">{{title}}</span>
            {{/project}}
          </td>
        </tr>
        </table>
        </a>
        {{#project}}
        <a href="/report/write/{{_id}}" style="text-decoration:none;">
        <div class="block" style="height:80px;padding-right:20px;float:right;display:inline-block;">
          <div class="centered">
          <table style="background:#323845;padding:5px;border-radius:3px;">
            <tr>
            <td>
              <i style="padding-left:6px;padding-right:6px;color:#FFF" class="material-icons">add_circle_outline</i>
            </td>
            <td>
            <span style="font-size:14px;padding-right:6px;color:#FFF">ADD REPORTS</span>
            </td>
            </tr>
          </table>
          </div>
        </div>
        </a>
        {{/project}}
      </div>
    </div>
    <div style="height:100%;width:15%;float:left;background:#323845;">
    <div style="height:80px"></div>
    {{#project}}
    <a href="/project/{{_id}}" class="menu">
    <div style="height:60px;padding:0px 15px 0px 15px;">
      <table>
        <tr>
          <td>
            <i class="material-icons" style="color:rgba(255, 255, 255, 0.3);">visibility</i>
          </td>
          <td>
            <p style="padding-left:5px;color:rgba(255, 255, 255, 0.7)">home</p>
          </td>
        </tr>
      </table>
    </div>
    </a>
    <a href="/report/list/{{_id}}" class="menu">
    <div style="height:60px;padding:0px 15px 0px 15px;background-color:#1D1F29;">
      <table>
        <tr>
          <td>
            <i class="material-icons" style="color:rgba(255, 255, 255, 0.3);">description</i>
          </td>
          <td>
            <p style="padding-left:5px;color:rgba(255, 255, 255, 0.7)">reports</p>
          </td>
        </tr>
      </table>
    </div>
    </a>
    <a href="/drive/folder/{{_id}}" class="menu">
    <div style="height:60px;padding:0px 15px 0px 15px">
      <table>
        <tr>
          <td>
            <i class="material-icons" style="color:rgba(255, 255, 255, 0.3);">folder</i>
          </td>
          <td>
            <p style="padding-left:5px;color:rgba(255, 255, 255, 0.7)">drive</p>
          </td>
        </tr>
      </table>
    </div>
    </a>
    {{/project}}
    </div>
    <div style="height:100%;width:85%;float:right;background:#F5F5F5;">
      <div style="height:100%;width:30%;float:left;background:#F5F5F5;">
        <div style="max-height:calc(100% - 160px);width:calc(100% - 60px);float:left;margin-top:110px;margin-bottom:30px;margin-left:20px;margin-right:20px;background:#FFF;overflow-y:auto;padding:10px;box-shadow:rgba(0,0,0,0.12) 0px 0px 3px;">
        <span style="font-size:16px;color:rgba(0, 0, 0, 0.54)">REPORTS</span>
        <div class="divider">
        </div>
        <div style="width:100%">
          <table class="tablelist" style="width:100%;border-color:rgba(0,0,0,0.05)" frame=void border=1px rules=rows>
            {{#reports}}
            <tr>
              <td onclick="window.location='/report/{{_id}}'" style="padding:10px">
                <p style="margin:0;font-size:18px;color:rgba(0, 0, 0, 0.87);">{{topic}}</p>
                <p style="margin:0;font-size:14px;color:rgba(0, 0, 0, 0.54);">#{{date}}</p>
              </td>
            </tr>
            {{/reports}}
          </table>
        </div>
        </div>
      </div>
      <div style="height:100%;width:70%;float:right;background:#F5F5F5;">
        <div style="max-height:calc(100% - 160px);width:calc(100% - 60px);float:left;margin-top:110px;margin-bottom:30px;margin-left:20px;margin-right:20px;background:#FFF;overflow-y:scroll;padding:10px;box-shadow: rgba(0,0,0,0.12) 0px 0px 3px;">
        <span style="font-size:16px;color:rgba(0, 0, 0, 0.54)">WRITE</span>
        <div class="divider">
        </div>
        <div style="width:100%;">
          <form method="post" action="/report/update" enctype="multipart/form-data">
          <table style="width:100%;border-color:rgba(0,0,0,0.05)" frame=void>
              <tr>
              <td style="width:100%;padding:10px">
                <p style="margin:0;font-size:14px;color:rgba(0, 0, 0, 0.54);">참석자</p>
              </td>
              </tr>
              <input type="hidden" name="reportid" value="{{rid}}">
              <input type="hidden" name="reportrev" value="{{rrev}}">
              {{#people}}
              <tr>
                <td style="float:left;padding-left:10px">
                  <input type="checkbox" class="checkbox" checked="">
                </td>
                <td style="float:left;padding-left:10px">
                  {{name}}
                </td>
              </tr>
              <tr>
                <td style="float:left;padding-top:15px;padding-left:10px;padding-right:10px;width:100%">
                  <input type="hidden" name="attendee" value="{{id}}">
                  <input style="width:calc(100% - 20px);-webkit-filter: grayscale(100%);" value="{{reason}}" type="text" name="attendeeReason" placeholder="{{name}} 불참사유">
                </td>
              </tr>
              <tr>
                <td style="height:15px">
                </td>
              </tr>
              {{/people}}
              <tr>
              <td style="width:100%;padding:10px">
                <p style="margin:0;font-size:14px;color:rgba(0, 0, 0, 0.54);">시작시간 (*)</p>
                <input type="text" name="start" style="width:100%" data-field="datetime" value="{{starttime}}" readonly>
              </td>
              </tr>
              <tr>
              <td style="width:100%;padding:10px">
                <p style="margin:0;font-size:14px;color:rgba(0, 0, 0, 0.54);">종료시간 (*)</p>
                <input type="text" name="end" style="width:100%" data-field="datetime" value="{{endtime}}" readonly>
              </td>
              </tr>
              <tr>
              <td style="width:100%;padding:10px">
                <p style="margin:0;font-size:14px;color:rgba(0, 0, 0, 0.54);">제외시간 (*) (분단위)</p>
                <input style="width:100%" type="number" name="except" value="{{excepttime}}">
              </td>
              </tr>
              <tr>
              <td style="width:100%;padding:10px">
                <p style="margin:0;font-size:14px;color:rgba(0, 0, 0, 0.54);">장소 (*)</p>
                <input style="width:100%" type="text" name="place" value="{{place}}">
              </td>
              </tr>
              <tr>
              <td style="width:100%;padding:10px">
                <p style="margin:0;font-size:14px;color:rgba(0, 0, 0, 0.54);">주제 (*)</p>
                <input style="width:100%" type="text" name="topic" value="{{topic}}">
              </td>
              </tr>
              <tr>
              <td style="width:100%;padding:10px">
                <p style="margin:0;font-size:14px;color:rgba(0, 0, 0, 0.54);">목표 (*)</p>
                <input style="width:100%" type="text" name="goal" value="{{goal}}">
              </td>
              </tr>
              <tr>
              <td style="width:100%;padding:10px">
                <p style="margin:0;font-size:14px;color:rgba(0, 0, 0, 0.54);">추진내용 (*)</p>
                <textarea style="width:100%;margin-top:10px;max-width:100%!important;resize:vertical;overflow:visible" type="text" onkeyup="resize(this)" name="issue">{{issue}}</textarea>
              </td>
              </tr>
              <tr>
              <td style="width:100%;padding:10px">
                <p style="margin:0;font-size:14px;color:rgba(0, 0, 0, 0.54);">해결방안 (*)</p>
                <textarea style="width:100%;margin-top:10px;max-width:100%!important;resize:vertical;overflow:visible" type="text" onkeyup="resize(this)" name="solution">{{solution}}</textarea>
              </td>
              </tr>
              <tr>
              <td style="width:100%;padding:10px">
                <p style="margin:0;font-size:14px;color:rgba(0, 0, 0, 0.54);">향후계획 (*)</p>
                <input style="width:100%" type="text" name="plan" value="{{plan}}">
              </td>
              </tr>
              <tr>
              <td style="width:100%;padding:10px">
                <p style="margin:0;font-size:14px;color:rgba(0, 0, 0, 0.54);">멘토의견 (*)</p>
                <input style="width:100%" type="text" name="opinion" value="{{opinion}}">
              </td>
              </tr>
              <tr>
                <td style="float:left;padding-left:10px">
                  <input type="checkbox" name="opinion-public" class="checkbox">
                </td>
                <td style="float:left;padding-left:2px;padding-top:3px">
                  멘토의견 공개
                </td>
              </tr>
              <tr>
              <td style="width:100%;padding:10px">
                <p style="margin:0;font-size:14px;color:rgba(0, 0, 0, 0.54);">기타</p>
                <textarea style="width:100%;margin-top:10px;max-width:100%!important;resize:vertical;overflow:visible" type="text" onkeyup="resize(this)" name="etc">{{etc}}</textarea>
              </td>
              </tr>
              <tr>
              <td style="width:100%;padding:10px 10px 30px 10px">
                <p style="margin:0;font-size:14px;color:rgba(0, 0, 0, 0.54);">내용 (*)</p>
                <textarea style="width:100%;margin-top:10px;max-width:100%!important;resize:vertical;overflow:visible" type="text" onkeyup="resize(this)" name="content">{{content}}</textarea>
              </td>
              </tr>
              <tr>
              <td style="width:100%;padding:10px 10px 10px 10px">
                <p style="margin:0;font-size:14px;color:rgba(0, 0, 0, 0.54);">인증사진</p>
                <label for="photoUpload">
                <div class="block" style="height:80px;float:left;display:inline-block;">
                <div class="centered">
                  <table style="background:#323845;padding:5px;border-radius:3px;">
                    <tr>
                      <td>
                        <i style="padding-left:6px;padding-right:6px;color:#FFF" class="material-icons">add_circle_outline</i>
                      </td>
                      <td>
                        <span style="font-size:14px;padding-right:6px;color:#FFF">UPLOAD IMAGE</span>
                      </td>
                    </tr>
                  </table>
                </div>
                </div>
                </label>
                <input id="photoUpload" type="file" name="file" style="display: none;"/>
                <table id="photoTable" style="width:100%">
                {{#photo}}
                  <tr class="uploadedPhoto">
                    <td><span id="photoName" style="color:rgba(0, 0, 0, 0.87);">{{name}}</span></td><td><a id="deletePhoto" href="#" onclick="deletePhoto(); return false;">삭제</a></td><input type="hidden" id="userPhoto" name="photo" value="{{id}}"></tr>
                {{/photo}}
                </table>
              </td>
              </tr>
              <tr>
              <td style="width:100%;padding:10px 10px 10px 10px">
                <p style="margin:0;font-size:14px;color:rgba(0, 0, 0, 0.54);">파일</p>
                <label for="fileUpload">
                <div class="block" style="height:80px;float:left;display:inline-block;">
                <div class="centered">
                  <table style="background:#323845;padding:5px;border-radius:3px;">
                    <tr>
                      <td>
                        <i style="padding-left:6px;padding-right:6px;color:#FFF" class="material-icons">add_circle_outline</i>
                      </td>
                      <td>
                        <span style="font-size:14px;padding-right:6px;color:#FFF">UPLOAD FILE</span>
                      </td>
                    </tr>
                  </table>
                </div>
                </div>
                </label>
                <input id="fileUpload" type="file" name="file" style="display: none;"/>
                <table id="fileTable" style="width:100%">
                {{#files}}
                  <tr class="{{id}}">
                    <td>
                      <span style="color:rgba(0, 0, 0, 0.87);">{{name}}</span>
                    </td>
                    <td>
                      <a href="#" onclick="deleteFile('{{id}}'); return false;">삭제</a></td><input type="hidden" name="fileList" value="{{id}}"></tr>
                {{/files}}
                </table>
              </td>
              </tr>
              <tr>
                <td>
                  <button style="width:120px" type="submit">
                    <i class="material-icons" style="color: white;">done</i>
                  </button>
                </td>
              </tr>
          </table>
          </form>
        </div>
        </div>
      </div>
    </div>
    <div id="dtBox"></div>
    </div>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script>
    <script src="https://code.jquery.com/ui/1.11.4/jquery-ui.min.js"></script>
    <script type="text/javascript" src="http://cdn.jsdelivr.net/datetimepicker/latest/DateTimePicker.min.js"></script>
    <script src="https://cdn.rawgit.com/fgnass/spin.js/master/spin.min.js"></script>
    <script src="https://cdn.rawgit.com/taitems/iOS-Overlay/gh-pages/js/iosOverlay.js"></script>
    <script src="https://rawgit.com/blueimp/jQuery-File-Upload/master/js/jquery.fileupload.js" type="text/javascript"></script>
    <script>
    {{#photo}}
    var isUploaded = true;
    {{/photo}}
    {{^photo}}
    var isUploaded = false;
    {{/photo}}
    function resize(obj) {
      obj.style.height = "1px";
      obj.style.height = (20+obj.scrollHeight)+"px";
    }

    function addPhoto(photoId, photoName){
      isUploaded = true;
      $("table#photoTable").append('<tr class="uploadedPhoto"><td><span id="photoName" style="color:rgba(0, 0, 0, 0.87);">'+photoName+'</span></td><td><a id="deletePhoto" href="#" onclick="deletePhoto(); return false;">삭제</a></td><input type="hidden" id="userPhoto" name="photo" value="'+photoId+'"></tr>');
      overlay.hide();
    }

    function deletePhoto(){
      isUploaded = false;
      $("tr").remove(".uploadedPhoto");
    }

    function addFile(fileId, fileName){
      $("table#fileTable").append('<tr class="'+fileId+'"><td><span style="color:rgba(0, 0, 0, 0.87);">'+fileName+'</span></td><td><a href="#" onclick="deleteFile(\''+fileId+'\'); return false;">삭제</a></td><input type="hidden" name="fileList" value="'+fileId+'"></tr>');
        overlay.hide();
    }

    function deleteFile(id){
      $("tr").remove("."+id);
    }

    var overlay;
    var opts = {
        lines: 13, // The number of lines to draw
        length: 11, // The length of each line
        width: 5, // The line thickness
        radius: 17, // The radius of the inner circle
        corners: 1, // Corner roundness (0..1)
        rotate: 0, // The rotation offset
        color: '#FFF', // #rgb or #rrggbb
        speed: 1, // Rounds per second
        trail: 60, // Afterglow percentage
        shadow: false, // Whether to render a shadow
        hwaccel: false, // Whether to use hardware acceleration
        className: 'spinner', // The CSS class to assign to the spinner
        zIndex: 2e9, // The z-index (defaults to 2000000000)
        top: 'auto', // Top position relative to parent in px
        left: 'auto' // Left position relative to parent in px
      };
      $(document).bind('drop dragover', function (e) {
        e.preventDefault();
      });
      $(document).ready(function()
      {
        $("#dtBox").DateTimePicker({
          dateTimeFormat: "yyyy-MM-dd HH:mm:ss",
          shortDayNames:["일","월","화","수","목","금","토"],
          fullDayNames:["일요일","월요일","화요일","수요일","목요일","금요일","토요일"],
          shortMonthNames:["1월", "2월", "3월", "4월", "5월", "6월", "7월", "8월", "9월", "10월", "11월", "12월"],
          fullMonthNames:["1월", "2월", "3월", "4월", "5월", "6월", "7월", "8월", "9월", "10월", "11월", "12월"]
        });
        $('#photoUpload').fileupload({
        {{#project}}
        url : '/drive/file/upload/{{_id}}',
        {{/project}}
        dataType: 'json',
        //replaceFileInput: false,
        add: function(e, data){
            if(!isUploaded){
            var uploadFile = data.files[0];
            data.submit();
            var target = document.createElement("div");
            document.body.appendChild(target);
            var spinner = new Spinner(opts).spin(target);
            overlay = iosOverlay({
              text: "Uploading...",
              spinner: spinner
            });
            }
        }, progressall: function(e,data) {

        }, done: function (e, data) {
            console.log(data);
            var code = data.result.code;
            var msg = data.result.msg;
            if(code == '1') {
              addPhoto(data.result.fileid, data.result.originalname);
            } else {
                alert(code + ' : ' + msg);
            }
        }, fail: function(e, data){
            console.log(data);
            console.log(data.errorThrown);
            console.log(data.textStatus);
            console.log(data.jqXHR);
            overlay.hide();
            alert('업로드 중 문제가 발생했습니다');
            foo = data;
        }
      });
      $('#fileUpload').fileupload({
        {{#project}}
        url : '/drive/file/upload/{{_id}}',
        {{/project}}
        dataType: 'json',
        //replaceFileInput: false,
        add: function(e, data){
            var uploadFile = data.files[0];
            data.submit();
            var target = document.createElement("div");
            document.body.appendChild(target);
            var spinner = new Spinner(opts).spin(target);
            overlay = iosOverlay({
              text: "Uploading...",
              spinner: spinner
            });
        }, progressall: function(e,data) {

        }, done: function (e, data) {
            console.log(data);
            var code = data.result.code;
            var msg = data.result.msg;
            if(code == '1') {
              addFile(data.result.fileid, data.result.originalname);
            } else {
                alert(code + ' : ' + msg);
            }
        }, fail: function(e, data){
            console.log(data);
            console.log(data.errorThrown);
            console.log(data.textStatus);
            console.log(data.jqXHR);
            overlay.hide();
            alert('업로드 중 문제가 발생했습니다');
            foo = data;
        }
      });
      });
    </script>
  </body>
</html>